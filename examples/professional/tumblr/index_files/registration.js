/*! scripts/antispam/client_profiling.js */
!function(e,t,n,s){s.CLP=t.View.extend({el:"body",initialize:function(t){this.options=t||{},this.url=t.url||!1,this.form_key=e("#tumblr_form_key").attr("content")},template:n.template('<iframe id="clp" class="clp" height="0" width="0" src="<%- this.url %>/?f=<%- this.form_key %>" style="border: 0; visibility: hidden; height: 0; width: 0; position: absolute; left: -10000px;"></iframe>'),render:function(){return this.rendered||(this.rendered=!0,this.$el.append(this.template())),this},rendered:!1})}(jQuery,Backbone,_,Tumblr),/*! scripts/email_checker.js */
function(e,t){var n={dictionary:[],maxTransforms:1,costMultiplier:1,damerauLevenshteinDist:function(e,t,n){if("string"!=typeof e||"string"!=typeof t)return!1;"number"!=typeof n&&(n=99);var s=0,a=0,i=0,r=e.length,o=t.length;if(0===r||0===o)return Math.abs(r-o)<=n?Math.max(r,o):!1;if(o>r){var u;u=r,r=o,o=u,u=e,e=t,t=u}var c=[];for(s=0;r>=s;s++)c[s]=[],c[s][0]=s;for(a=0;o>=a;a++)c[0][a]=a;for(s=1;r>=s;s++)for(a=1;o>=a;a++)i=e[s-1]==t[a-1]?0:1,c[s][a]=Math.min(c[s-1][a]+1,c[s][a-1]+1,c[s-1][a-1]+i),1!=s&&1!=a&&e[s-1]==t[a-2]&&e[s-2]==t[a-1]&&(c[s][a]=Math.min(c[s][a],c[s-2][a-2]+i));return c[r][o]<=n?c[r][o]:!1},returnFunc:function(e,t){return e.name},suggest:function(t){var n=[],s=0,a=this.damerauLevenshteinDist,i=this.maxTransforms;this.returnFunc;return e.each(this.dictionary,function(e,r){(s=a(t,r.name,i))!==!1&&n.push({name:r.name,dist:s,cost:r.cost})}),n.length?e.map(n.sort(this.sortByFunc),this.returnFunc):[]},sortByFunc:function(e,t){var n=e.dist+e.cost*this.costMultiplier,s=t.dist+t.cost*this.costMultiplier;return n-s},initialized:!1,init:function(t,n){if(!(t instanceof Array))return!1;var s,a=[];if(e.each(t,function(e,t){var n=typeof t;"object"===n?a.push(t):"string"===n&&a.push({name:t,cost:0})}),this.dictionary=a,"object"==typeof n)for(s in n)n.hasOwnProperty(s)&&this.hasOwnProperty(s)&&(this[s]=n[s]);return this.initialized=!0,this}};t.SpellChecker=n}(jQuery,Tumblr),"undefined"!=typeof Tumblr||(Tumblr={}),function(e,t){var n=Backbone.View.extend({initialize:function(e){if(this.options=e||{},!window.Recaptcha){var t=document.createElement("script");t.src="//www.google.com/recaptcha/api/js/recaptcha_ajax.js",t.onload=_.bind(this.setup_captcha,this);var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}},setup_captcha:function(){this.$captcha_input=e("#recaptcha_response_field"),this.$captcha_controls=e(".captcha_control"),this.$captcha_controls.on("click.recaptcha",_.bind(_.throttle(function(t){var n=e(t.target);n.hasClass("audio")&&this.audio(),n.hasClass("visual")&&this.visual(),n.hasClass("refresh")&&this.refresh()},1e3),this)),this.captcha_callback=this.options.callback||function(){},this.captcha_callback()},audio:function(){window.Recaptcha.switch_type("audio"),this.update_placeholder()},visual:function(){window.Recaptcha.switch_type("image"),this.update_placeholder()},refresh:function(){window.Recaptcha.reload()},update_placeholder:function(){var e="image"===window.Recaptcha.type?this.$captcha_input.data("placeholder-visual"):this.$captcha_input.data("placeholder-audio");this.$captcha_input.attr({placeholder:e})}});Tumblr.Recaptcha=n}(jQuery,Tumblr),"undefined"!=typeof Tumblr||(Tumblr={}),function(e,t){var n,s=Backbone.View.extend({initialize:function(e){this.options=e||{};var t=document.createElement("script");t.src="//www.google.com/recaptcha/api.js?render=explicit&onload=onNocaptchaCallback",window.onNocaptchaCallback=_.bind(this.setup_captcha,this);var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},setup_captcha:function(){window.grecaptcha.render(this.options.target||"g-recaptcha",{callback:this.options.callback||function(){},theme:this.options.theme||"light",type:this.options.type||"image",sitekey:this.options.sitekey||e(".g-recaptcha").data("sitekey")}),Tumblr.Events&&Tumblr.Events.on("abouttumblr:change",function(e){0!==e&&5!==e||window.grecaptcha.reset()})},refresh:function(){window.grecaptcha.reset()}});Tumblr.NoCaptcha=function(e){return n||(n=new s(e)),n}}(jQuery,Tumblr),/*! scripts/tfa_code.js */
function(e,t,n,s){var a=n.View.extend({initialize:function(e){this.options=e||{}},resend_token_sms:function(t,n){var s=e("#tfa_sms_resend");s.addClass("animate"),e.ajax({url:"/svc/tfa/resend_token_sms",data:{email:t,tfa_form_key:n.val()},withFormKey:!0,dataType:"json",type:"POST"}).done(function(e){n.val(e.tfa_form_key)}).fail(function(){}).always(function(){s.removeClass("animate")})}});Tumblr.TFACode=a}(jQuery,_,Backbone,Tumblr),/*! scripts/registration/username_suggester.js */
function(e,t,n,s){"use strict";s.UsernameSuggester=t.View.extend({el:"body",defaults:{username_input:"#signup_username"},events:{"click #suggested_usernames .popover_menu_item":"handle_click"},initialize:function(e){this.options=e||{},this.options=n.extend(this.defaults,this.options)},handle_click:function(t){e(this.options.username_input).val(t.target.innerHTML).focus(),e("#used_suggestion").val(1),e("#used_auto_suggestion").val(0),e("#suggested_usernames_container").addClass("hidden")}})}(jQuery,Backbone,_,Tumblr),"undefined"!=typeof Tumblr||(Tumblr={}),Tumblr.RegistrationForm=function(e){function t(t){$.current_view=t,e("body").addClass("show_form").addClass(t),loading_next_page=!0,s(t),a(),K.track_event("update_view",t)}function n(t){reset_form=void 0===t,t=t||"show_form signup_get_started signup_determine signup_account signup_birthday signup_register signup_login slow_motion now",e.each(t.split(/\s+/),function(t,n){e("body").removeClass(n)}),e("#signup_button_signup").length&&e("#signup_button_signup").removeClass("shallow").addClass("other_blue"),loading_next_page=!1,$.current_view=null,M=null,reset_form&&g(),reset_form&&K.track_event("reset_view")}function s(t){var n,s=e("#"+t);e("#signup_forms_submit").removeClass("changed"),M=e("#"+t+" input"),E.attr("action",E.attr("data-secure-ajax-action"));var a="signup_login"===t?"signup_account":t;if(e(".signup_forms_panel .signup_view:not(#"+a+")").removeClass("active"),e(".signup_forms_submit span").removeClass("active"),"signup_login"===t?e("#signup_account").addClass("active"):s.addClass("active"),e(".signup_forms_submit ."+t+"_btn").addClass("active"),o(),r(),P(t)&&(u(),E.attr("action",E.attr("data-secure-action")),M=e('#signup_account input:not("#signup_username")'),e("#signup_button_signup").length&&e("#signup_button_signup").addClass("shallow").removeClass("other_blue"),$.errors&&(d($.errors),$.errors=null),e("body").hasClass("has_login_captcha")?(W(function(){Tumblr.NoCaptcha({target:"g-recaptcha",sitekey:e(".g-recaptcha").data("sitekey")})},function(){F(function(){window.Recaptcha.create(e("#recaptcha_public_key").val(),"recaptcha_widget",{theme:"custom",custom_theme_widget:"recaptcha_widget",callback:function(){window.Recaptcha.focus_response_field,e("#signup_forms_panel").css("display","none"),e("#signup_forms_panel").css("display","block")}})})}),Tumblr.Events.trigger("loginregister:captchaShown"),e("#signup_password").focus(),e("#signup_username").prop("tabindex","-1")):e("body").hasClass("has_login_tfa")?(e("#tfa_response_field").focus(),e("#tfa_sms_resend").click(function(e){e.preventDefault(),i()})):e("body").hasClass("mobile_splash_active")||e("#signup_email").focus()),"signup_login"==t&&e("body").hasClass("signup_determine")&&(!e("#signup_password").val()&&e("#signup_password_hidden").val()&&e("#signup_password").val(e("#signup_password_hidden").val()),e(".forgot_password_container").css("display","inline-block"),e("#signup_email").val(e("#signup_determine_email").val()),e("#signup_email").attr("readonly","readonly"),e("#signup_password").focus()),"signup_account"==t&&(e("body").hasClass("mobile_splash_active")||e("#signup_email").focus(),e("body").hasClass("signup_determine")&&(e("#signup_email").val(e("#signup_determine_email").val()),e("#signup_email").attr("readonly","readonly"),e("#signup_password").focus()),H&&(J?J.update():J=new Tumblr.PasswordStrengthMeter),s.keydown(function(t){n=e(t.target),n.hasClass("signup_username")&&(e("#used_suggestion").val(0),e("#used_auto_suggestion").val(0))}),Tumblr.Flags.bool("show_random_username_suggestions"))){var p;try{p=JSON.parse(e("#random_username_suggestions").val())}catch(_){p=!1}p&&(e("#signup_username").on("focus",function(){e(this).val()||l(p,Tumblr.Flags.bool("autopopulate_username_suggestion"))}),e(".signup_username").on("keyup",function(){e(".signup_username_checkmark").toggle(p.indexOf(e(this).val())>-1)}))}"signup_birthday"==t?(setTimeout(function(){e("#signup_age").focus()},500),c(e("#signup_age")),s.keyup(function(t){n=e(t.target),n.hasClass("signup_age")&&c(n)}),s.keydown(function(t){n=e(t.target),n.hasClass("signup_age")&&c(n)}),s.keypress(function(t){n=e(t.target),n.hasClass("signup_age")&&c(n)}),e(".signup_terms_link").attr("tabindex",0)):e(".signup_terms_link").attr("tabindex",-1),"signup_register"==t&&W(function(){Tumblr.NoCaptcha({target:"g-recaptcha",sitekey:e(".g-recaptcha").data("sitekey"),callback:y})},function(){F(function(){window.Recaptcha.create(e("#recaptcha_public_key").val(),"recaptcha_widget",{theme:"custom",custom_theme_widget:"recaptcha_widget",callback:function(){window.Recaptcha.focus_response_field,e("#signup_forms_panel").css("display","none"),e("#signup_forms_panel").css("display","block")}}),Tumblr.Events.trigger("loginregister:captchaShown")}),s.keyup(function(){e("#signup_forms_submit").addClass("changed")})}),"signup_determine"==t&&(e("body").hasClass("mobile_splash_active")||e("body").hasClass("is_mobile_handset")||setTimeout(function(){e("#signup_determine_email").focus()},1e3))}function a(){e("body").hasClass("signup_account")?e(".signup_link.login-button").attr("tabindex",2):e("body").hasClass("signup_get_started")?(e(".logo_anchor").attr("tabindex",-1),e(".signup_forms_submit_helper").attr("tabindex",-1)):e("body").hasClass("signup_determine")&&(e(".logo_anchor").attr("tabindex",-1),e(".signup_forms_submit_helper").attr("tabindex",-1),e(".signup_link.signup-button").attr("tabindex",2))}function i(){G||(G=new Tumblr.TFACode),G.resend_token_sms(e("#signup_email").val(),e("#tfa_form_key"))}function r(){e("#"+$.current_view+" input").each(function(t){e(this).removeAttr("disabled")})}function o(){e("#signup_form .form_row input").each(function(t){e(this).attr("disabled","disabled")})}function u(){e("#signup_form .form_row input").each(function(t){e(this).removeAttr("disabled")})}function c(t){label=e("label[for='"+t.attr("id")+"']"),slug=label.children().first(),slug.text(t.val()),""===t.val()?(t.addClass("is_empty"),label.addClass("is_empty")):(t.removeClass("is_empty"),label.removeClass("is_empty"))}function l(t,n){var s=e("#suggested_usernames"),a=e("#suggested_usernames_container"),i=(e("#suggested_usernames_container .username_note"),e("#suggested_usernames_container .popover_inner"),t.length);n=n||!1,n===!0&&(e(".signup_username").val(t[0]),e(".signup_username_checkmark").show(),e("#used_auto_suggestion").val(1)),s.html("");for(var r=0;i>r;r++){var o=e("<li></li>");o.attr("class","popover_menu_item"),o.attr("tabindex",0),o.html(t[r]),s.append(o)}a.removeClass("hidden"),O=new Tumblr.Popover({el:"#suggested_usernames_container",direction:"left",skip_glass:!0}),O.show(),new Tumblr.UsernameSuggester,e("#seen_suggestion")[0].value++}function p(t){var n,s,a=e("#signup_form_errors"),i=t.length;for(a.html(""),s=i-1;s>=0;s--){n=e("<li></li>"),n.attr("class","error"),n.html(t[s]),a.append(n);var r=t[s].replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"");K.track_event("error",r)}}function d(t){t&&t.length&&(p(t),e("#signup_forms").addClass("has_errors")),W(function(){window.grecaptcha&&(window.grecaptcha.reset(),Tumblr.Events.trigger("loginregister:captchaShown"))},function(){window.Recaptcha&&(window.Recaptcha.reload(),Tumblr.Events.trigger("loginregister:captchaShown"))}),A||e("#signup_forms_container").addClass("shake").addClass("animated");setTimeout(function(){e("#signup_forms_container").removeClass("shake")},500)}function g(){e("#signup_form")[0].reset(),m()}function m(){e("#signup_forms_container").removeClass("shake"),e("#signup_forms").removeClass("has_errors")}function h(){var t,n,s,a=M.length,i=[];for(s=a-1;s>=0;s--)if(t=M[s],(""===t.value||"checkbox"==t.type&&t.checked===!1)&&e(t).attr("data-required")){switch(t.id){case"signup_email":n=j(["Don't forget your email address!","You forgot to enter your email address!"]);break;case"signup_password":n=j(["Don't forget your password!","You forgot to enter your password!"]);break;case"signup_username":n=j(["Don't forget your username!","You forgot to enter your username!"]);break;case"signup_age":n=j(["Don't forget to tell us your age!","You forgot to tell us your age."]);break;case"signup_tos":n=j(["One more thing &ndash; please accept our Terms!","You must accept Tumblr's terms before proceeding."]);break;case"recaptcha_response_field":n=j(["Don't forget to fill out the Captcha!","Please fill out the Captcha."]);break;default:n=j(["There was an error. Please try again.","Oops. There was an error. Try again."])}i.push(__(n))}return i.length?(d(i),!1):!0}function f(e){return"signup_email"==e.attr("id")||"signup_determine_email"==e.attr("id")}function b(t){if(P($.current_view))return!0;t=e(t);var n,s=[],a=t.val();if(""!==a){if(f(t)&&!a.match(/\@ymail.com$/i)){var i,r,o,u,c,l;Tumblr.SpellChecker.init(z,{costMultiplier:.05}),o=(r=a.match(/[^@]+$/))?r[0]:"",/\@/.test(a)?-1!=a.toLowerCase().indexOf("@tumblr.com")?n=j(["That email address is already in use. Please try again.","That email address is already associated with another account."]):!Z&&(i=Tumblr.SpellChecker.suggest(o)).length&&(c=a.split("@")[0]+"@"+i[0],c!=a&&(l=__("Oops. Did you mean %1$s ?"),email_placeholder="%1$s",u='<a href="#" id="'+t.attr("id")+'_suggestion">'+c+"</a>",n=l.replace(email_placeholder,u,"g"),Z=!0)):n="That's not a valid email address. Please try again."}if("signup_password"==t.attr("id")&&(""==e.trim(a)&&(n="Don't forget your password!"),J&&J.block_registration_step&&(n=J.block_registration_step)),"signup_username"==t.attr("id")&&(a.length>0&&a.indexOf("-",a.length-1)===a.length-1&&(n="Can't do dashes at the start or end. Middles only."),0===a.lastIndexOf("-",0)&&(n="Can't do dashes at the start or end. Middles only."),-1!=a.toLowerCase().indexOf("tumblr")&&(n="Rule #14: You can't put Tumblr in your username.")),"signup_age"==t.attr("id")){var p=parseInt(a),_=new String(p),g=a.replace(/^\s+|\s+$/g,"");_!=g?n="Please enter your age as a number only!":1>p&&(n="Please enter a number!")}n&&s.push(__(n))}return s.length?(d(s),!1):(m(),!0)}function v(){for(var e=M.length-1;e>=0;e--)if(!b(M[e]))return!1;return h()}function w(){e(O).length&&(e("#suggested_usernames_container").addClass("hidden"),e(O).hide())}function y(){return m(),P($.current_view)?(E.submit(),!0):void("signup_account"!==$.current_view||E.find("#signup_username").val()?v()&&(w(),u(),signup_form_data=E.serialize()+"&action="+encodeURIComponent($.current_view)+"&tracking_url="+encodeURIComponent(I)+"&tracking_version="+encodeURIComponent(Q),e.ajax(E.attr("action"),{type:"POST",data:signup_form_data,error:function(e,t,n){try{e=JSON.parse(e.responseText)}catch(s){e={}}e.redirect?(K.track_event("error","redirect"),window.location.replace(e.redirect)):(d(e.errors),e.usernames&&setTimeout(function(){A||l(e.usernames,Tumblr.Flags.bool("autopopulate_username_suggestion"))},750)),"signup_register"==$.current_view&&K.track_event("fail",V)},success:function(n){n.signup_success&&(K.track_event("success",V),Tumblr.Events.trigger("loginregister:flowComplete")),n.redirect?"POST"===n.redirect_method?(E.attr("action",n.redirect),E.submit()):window.location.replace(n.redirect):t(n.next_view?n.next_view:e("#"+$.current_view).next().attr("id"))}})):(E.prop("action",E.attr("data-secure-action")),E.submit()))}function k(e){e.length&&e.focus()}function C(t){"signup_email_suggestion"==e(t.target).attr("id")&&(e("#signup_email").val(e(t.target).html()),e("#signup_password").focus(),m(),t.preventDefault(),t.stopPropagation()),"signup_determine_email_suggestion"==e(t.target).attr("id")&&(e("#signup_determine_email").val(e(t.target).html()),m(),t.preventDefault(),t.stopPropagation())}function T(){e("body").hasClass("signup_get_started")?Tumblr.RegistrationForm.update_view("signup_get_started"):e("body").hasClass("signup_determine")?Tumblr.RegistrationForm.update_view("signup_determine"):e("body").hasClass("signup_login")?Tumblr.RegistrationForm.update_view("signup_login"):e("body").hasClass("signup_account")&&Tumblr.RegistrationForm.update_view("signup_account")}function x(){var t,n=e("#signup_subhead"),s=e("#signup_subhead_content");0!=n.length&&(t=n.width(),s.width()>t&&(n.addClass("medium"),setTimeout(function(){s.width()>t&&(n.addClass("small").removeClass("medium"),setTimeout(function(){s.width()>t&&n.addClass("infinitesimal").removeClass("small")},0))},0)))}function R(){L=e(".like_button, .reblog_button, .everyone_i_follow, .my_posts, .send_to_signup")}function P(e){return"signup_login"===e}function j(e){if(e.length){var t=e.length,n=Math.floor(Math.random()*t);return e[n]}}function F(e){new Tumblr.Recaptcha({callback:e})}var O,S,B,M,N,D,E,$,z,L,Q,I,V,Y,A,U,q,J,H,K,G,W,X,Z=!1,ee=[],te=("https:"===document.location.protocol,"");return z=[{name:"gmail.com",cost:0,share:30.2102985741},{name:"yahoo.com",cost:0,share:26.013029172},{name:"hotmail.com",cost:1,share:18.1002246857},{name:"aol.com",cost:6,share:3.03687405106},{name:"live.com",cost:9,share:2.06294942827},{name:"hotmail.co.uk",cost:10,share:1.95604539045},{name:"aim.com",cost:10,share:1.89339378918},{name:"mail.com",cost:17,share:1.2102985741},{name:"ymail.com",cost:18,share:1.0549753888},{name:"msn.com",cost:32,share:.609550330148}],{initialize:function(n){n=n||{},te=e("#tumblr_form_key").attr("content"),W=Tumblr.Flags("captcha_use_recaptcha2"),Y=document.body.className.match("is_login_register"),Y=!(!Y||!Y.length),U=e(document.body).hasClass("is_tablet"),q=e(document.body).hasClass("is_mobile_handset"),A=U||q,H=e(document.body).hasClass("show_password_strength"),E=e("#signup_form"),N=e("#signup_forms_submit"),D=e("#signup_login_button"),S=e(".signup_buttons .login_signup_button, #logo"),B=e(".signup_view"),signup_form_fields=e("#signup_form input"),$=this,Q="modal",I=document.location.pathname,V="?url="+I+"&version="+Q,R(),X=!1,n.clp_url&&n.clp_url.length&&Tumblr.CLP&&(X=new Tumblr.CLP({url:n.clp_url})),K=new Tumblr.OnboardingBehaviors,e(document).click(function(t){var n=e(t.target),s=n.parents(L.selector);if(s.length){var a=document.getElementById("signup_button_signup");a&&a.click(),t.preventDefault(),t.stopPropagation()}}),!Y&&E&&(e(window).keydown(function(n){return ee[n.keyCode]=1,ee[16]&&e("body").addClass("slow_motion"),ee[17]&&ee[18]&&ee[76]?(e("body").removeClass("slow_motion"),t("signup_login"),ee=[],!1):void 0}),e(window).keyup(function(t){if(ee[t.keyCode]=0,16==t.keyCode&&e("body").removeClass("slow_motion"),27==t.keyCode){if(e("body").hasClass("lite"))return;e("body").hasClass("already_logged_in")&&(window.location="/dashboard")}})),Tumblr.Events.on("MobileSplash:close",function(){k(e("#signup_email"))}),E.length&&(signup_form_fields.each(function(t){e(this).on("change",_.partial(b,this)),e(this).on("blur",function(){X&&!X.rendered&&"signup_account"==$.current_view&&X.render(),Tumblr.Events.trigger("loginregister:beginFlow")})}),E.on("keydown",function(e){13==e.keyCode&&(e.preventDefault(),e.stopPropagation(),y())}),e("#signup_form_errors").click(C),N.click(function(){y()}),D.click(function(){window.location="/login"}),e("#signup_forms_container").scroll(function(t){e("#signup_forms_container").scrollLeft(0)}),T(),$.errors&&(d($.errors),$.errors=null)),x()},update_send_to_signup_links:R,reset_view:function(){n()},update_view:function(e){n(),t(e)},current_view:null}}(jQuery),/*! scripts/registration/registration_behaviors.js */
function(e,t){var n=Backbone.View.extend({el:"body",events:{},initialize:function(){e("#signup_form input").on("focus",_.bind(function(e){this.tracking_events||(this.start_tracking_events(),this.tracking_events=!0)},this))},tracking_events:!1,track_event:function(e,t){_gaq&&_gaq.push(["_trackPageview","/signup/"+e])},start_tracking_events:function(){e("body").on("click",_.bind(function(e){var t=e.currentTarget,n=t.nodeName;n+=t.id.length?"-"+t.id:"",n+=t.className.length?"-"+t.className:"",this.track_event("clicked",n)},this)),e(window).on("keyup",_.bind(function(e){27==e.keyCode&&this.track_event("keypress","esc")},this))}});t.OnboardingBehaviors=n}(jQuery,Tumblr);